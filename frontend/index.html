<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Sales Analytics Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    // Set Chart.js global defaults immediately after it loads
    Chart.defaults.color = '#8a7d6e';
    Chart.defaults.borderColor = 'rgba(255,255,255,0.05)';
    Chart.defaults.font.family = "'DM Sans', sans-serif";
    Chart.defaults.font.size = 11;
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-utensils" style="color:var(--amber);font-size:0.85em;margin-right:4px"></i> Food Sales Analytics</h1>
            <div class="date-display">
                <span id="current-date"></span>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-container">
            <button class="tab-button active" onclick="openTab(event, 'order-tab')">
                <i class="fas fa-shopping-cart"></i> Orders
            </button>
            <button class="tab-button" onclick="openTab(event, 'analytics-tab')">
                <i class="fas fa-chart-bar"></i> Analytics
            </button>
            <button class="tab-button" onclick="openTab(event, 'reports-tab')">
                <i class="fas fa-file-alt"></i> Reports
            </button>
            <button class="tab-button" onclick="openTab(event, 'inventory-tab')">
                <i class="fas fa-boxes"></i> Inventory
            </button>
        </div>

        <!-- Order Tab -->
        <div id="order-tab" class="tab-content active">
            <div class="input-section">
                <h2><i class="fas fa-plus-circle"></i> Add New Order</h2>
                <div class="order-form">
                    <select id="dish-select">
                        <option value="">Select a dish</option>
                    </select>
                    <input type="number" id="quantity" min="1" value="1" placeholder="Quantity">
                    <button onclick="addOrder()">
                        <i class="fas fa-cart-plus"></i> Add Order
                    </button>
                </div>
            </div>

            <div class="quick-stats">
                <h3><i class="fas fa-bolt"></i> Quick Stats</h3>
                <div class="summary-cards">
                    <div class="card small">
                        <h4>Today's Sales</h4>
                        <p id="quick-sales">$0.00</p>
                    </div>
                    <div class="card small">
                        <h4>Today's Orders</h4>
                        <p id="quick-orders">0</p>
                    </div>
                    <div class="card small">
                        <h4>Popular Dish</h4>
                        <p id="popular-dish">-</p>
                    </div>
                </div>
            </div>

            <div class="recent-orders">
                <h3><i class="fas fa-history"></i> Recent Orders</h3>
                <div class="orders-table-container">
                    <table id="recent-orders-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Dish</th>
                                <th>Quantity</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="recent-orders-body">
                            <!-- Orders will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content">
            <div class="analytics-header">
                <h2><i class="fas fa-chart-line"></i> Sales Analytics</h2>
                <div class="date-selector">
                    <label for="analytics-date">Select Date:</label>
                    <input type="date" id="analytics-date" onchange="loadAnalyticsByDate()">
                </div>
            </div>

            <div class="summary-cards">
                <div class="card">
                    <h3>Total Sales</h3>
                    <p id="analytics-total-sales">$0.00</p>
                    <span id="sales-comparison" class="comparison-badge"></span>
                </div>
                <div class="card">
                    <h3>Total Orders</h3>
                    <p id="analytics-total-orders">0</p>
                    <span id="orders-comparison" class="comparison-badge"></span>
                </div>
                <div class="card">
                    <h3>Average Order Value</h3>
                    <p id="avg-order-value">$0.00</p>
                </div>
            </div>

            <div class="charts-row">
                <div class="chart-container" onclick="openChartZoom('dishesPieChart', 'fas fa-chart-pie', 'Dishes Sold Distribution')">
                    <span class="chart-expand-hint"><i class="fas fa-expand-alt"></i> Click to expand</span>
                    <h3><i class="fas fa-chart-pie"></i> Dishes Sold Distribution</h3>
                    <div class="chart-wrapper"><canvas id="dishesPieChart"></canvas></div>
                </div>
                <div class="chart-container" onclick="openChartZoom('peakHoursChart', 'fas fa-chart-bar', 'Peak Hours Analysis')">
                    <span class="chart-expand-hint"><i class="fas fa-expand-alt"></i> Click to expand</span>
                    <h3><i class="fas fa-chart-bar"></i> Peak Hours Analysis</h3>
                    <div class="chart-wrapper"><canvas id="peakHoursChart"></canvas></div>
                </div>
            </div>

            <div class="charts-row">
                <div class="chart-container full-width" onclick="openChartZoom('hourlyTrendChart', 'fas fa-chart-line', 'Hourly Sales Trend')">
                    <span class="chart-expand-hint"><i class="fas fa-expand-alt"></i> Click to expand</span>
                    <h3><i class="fas fa-chart-line"></i> Hourly Sales Trend</h3>
                    <div class="chart-wrapper"><canvas id="hourlyTrendChart"></canvas></div>
                </div>
            </div>

            <div class="comparison-section">
                <h3><i class="fas fa-calendar-compare"></i> Compare with Previous Day</h3>
                <div class="comparison-grid" id="comparison-details">
                    <!-- Comparison data will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports-tab" class="tab-content">
            <div class="reports-header">
                <h2><i class="fas fa-download"></i> Download Reports</h2>
                <div class="reports-controls">
                    <div class="date-range">
                        <input type="date" id="report-start-date" class="date-input">
                        <span>to</span>
                        <input type="date" id="report-end-date" class="date-input">
                    </div>
                    <button onclick="downloadReportRange()" class="primary-btn">
                        <i class="fas fa-download"></i> Download Report (CSV)
                    </button>
                </div>
            </div>

            <div class="report-templates">
                <h3><i class="fas fa-file-csv"></i> Quick Reports</h3>
                <div class="template-grid">
                    <div class="template-card" onclick="quickDownload('today')">
                        <i class="fas fa-calendar-day"></i>
                        <h4>Today's Report</h4>
                        <p>Download today's sales data</p>
                    </div>
                    <div class="template-card" onclick="quickDownload('yesterday')">
                        <i class="fas fa-calendar-day"></i>
                        <h4>Yesterday's Report</h4>
                        <p>Download yesterday's sales data</p>
                    </div>
                    <div class="template-card" onclick="quickDownload('week')">
                        <i class="fas fa-calendar-week"></i>
                        <h4>This Week</h4>
                        <p>Download weekly summary</p>
                    </div>
                    <div class="template-card" onclick="quickDownload('month')">
                        <i class="fas fa-calendar-alt"></i>
                        <h4>This Month</h4>
                        <p>Download monthly report</p>
                    </div>
                </div>
            </div>

            <div class="report-preview-section">
                <h3><i class="fas fa-eye"></i> Report Preview</h3>
                <div class="report-preview" id="report-preview">
                    <!-- Report preview will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Inventory Tab -->
        <div id="inventory-tab" class="tab-content">
            <div class="inventory-header">
                <h2><i class="fas fa-boxes"></i> Inventory Management</h2>
                <div style="display:flex;gap:10px">
                    <button onclick="openInventoryModal()" class="icon-btn amber-btn">
                        <i class="fas fa-plus"></i> Manage Ingredients
                    </button>
                    <button onclick="refreshInventory()" class="icon-btn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>

            <div class="inventory-summary">
                <div class="summary-card warning">
                    <h4>Low Stock Items</h4>
                    <p id="low-stock-count">0</p>
                </div>
                <div class="summary-card total">
                    <h4>Total Ingredients</h4>
                    <p id="total-ingredients">0</p>
                </div>
                <div class="summary-card value">
                    <h4>Inventory Value</h4>
                    <p id="inventory-value">$0.00</p>
                </div>
            </div>

            <!-- Full-width chart -->
            <div class="chart-container full-width-chart" style="margin-bottom:16px" onclick="openChartZoom('ingredientsChart', 'fas fa-chart-bar', 'Ingredients Remaining')">
                <span class="chart-expand-hint"><i class="fas fa-expand-alt"></i> Click to expand</span>
                <h3><i class="fas fa-chart-bar"></i> Ingredients Remaining</h3>
                <div class="chart-wrapper-tall"><canvas id="ingredientsChart"></canvas></div>
            </div>

            <!-- Ingredient list below chart -->
            <div class="inventory-list-container">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
                    <h3 style="margin:0"><i class="fas fa-list" style="color:var(--amber)"></i> Ingredient Details</h3>
                    <button onclick="openInventoryModal()" class="add-ing-btn">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="inventory-list" id="inventory-list"></div>
            </div>

            <div class="low-stock-alerts" id="low-stock-alerts"></div>
        </div><!-- /#inventory-tab -->
    </div><!-- /.container -->

        <!-- ── INVENTORY MODAL (outside container so it overlays everything) ── -->
        <div id="inventory-modal" class="modal-overlay" onclick="closeModalOnOverlay(event)">
            <div class="modal-box">
                <div class="modal-header">
                    <h2><i class="fas fa-boxes"></i> Manage Ingredients</h2>
                    <button class="modal-close" onclick="closeInventoryModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Add new ingredient form -->
                <div class="modal-add-form">
                    <h4><i class="fas fa-plus-circle" style="color:var(--amber)"></i> Add New Ingredient</h4>
                    <div class="modal-add-row">
                        <input type="text"   id="new-ing-name"  placeholder="Name (e.g. oregano)" class="modal-input">
                        <input type="text"   id="new-ing-unit"  placeholder="Unit (e.g. kg)"      class="modal-input short">
                        <input type="number" id="new-ing-stock" placeholder="Qty (0–100)" min="0" max="100" value="100" class="modal-input short">
                        <button onclick="addIngredientFromModal()" class="modal-add-btn">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>
                </div>

                <!-- Existing ingredients list -->
                <div class="modal-ing-list" id="modal-ing-list"></div>
            </div>
        </div>

    <!-- ── CHART ZOOM MODAL ── -->
    <div id="chart-zoom-modal" onclick="closeChartZoomOnOverlay(event)">
        <div class="chart-zoom-box">
            <div class="chart-zoom-header">
                <div class="chart-zoom-title">
                    <i id="chart-zoom-icon" class="fas fa-chart-bar"></i>
                    <span id="chart-zoom-title-text">Chart</span>
                </div>
                <button class="chart-zoom-close" onclick="closeChartZoom()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chart-zoom-body">
                <div class="chart-zoom-wrapper">
                    <canvas id="chartZoomCanvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>